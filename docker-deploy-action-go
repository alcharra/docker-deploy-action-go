#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

GITHUB_ACTION_PATH="${GITHUB_ACTION_PATH%/}"
RELEASE_VERSION="${GITHUB_ACTION_REF}"
BINARY_NAME="deploy-action_linux"
RELEASE_URL="https://github.com/alcharra/docker-deploy-action-go/releases/download/${RELEASE_VERSION}/${BINARY_NAME}"
TARGET="${GITHUB_ACTION_PATH}/${BINARY_NAME}"

echo "Downloading ${BINARY_NAME} from ${RELEASE_URL}"
curl -fsSL --retry 5 "${RELEASE_URL}" -o "${TARGET}"
chmod +x "${TARGET}"

"${TARGET}" "$@"
rm -f "${TARGET}"